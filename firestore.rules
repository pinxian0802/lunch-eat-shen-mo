rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // 允許所有已通過身份驗證的使用者（包括匿名登入）讀寫訂單
    match /artifacts/{appId}/public/data/orders/{orderId} {
      allow read, write: if request.auth != null; 
    }

    // 允許已登入的使用者讀寫自己的用戶資料
    match /artifacts/{appId}/public/data/users/{userId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // 餐廳資料 - 所有已登入用戶可讀寫
    match /artifacts/{appId}/public/data/restaurants/{restaurantId} {
      allow read, write: if request.auth != null;
    }

    // 個人午餐歷史 - 只能讀寫自己的
    match /artifacts/{appId}/public/data/lunchHistory/{userId}/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // 今日午餐選擇 - 所有人可讀，只能寫自己的
    match /artifacts/{appId}/public/data/todayLunches/{date}/{document=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }

    // 預設其他所有路徑都禁止存取 (確保安全)
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
